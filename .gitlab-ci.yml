image: python:3.11.2

variables:
  http_proxy: "$CODE_PROXY"
  https_proxy: "$CODE_PROXY"
  no_proxy: "$CODE_NO_PROXY"


before_script:
  - pip install -r requirements.txt
  - pip install ruff pylint


stages:
  - type-check
  - Code style
  - Static analysis


# Check code style, formatting, import sort order, etc.
basics:
  stage: Code style
  script:
    - ruff check
  tags:
    - LINUX-DOCKER


# A more thorough analysis of the code
pylint:
  stage: Static analysis
  script:
    - pylint --fail-under=9.38 resources
  tags:
    - LINUX-DOCKER


pyright:
  stage: type-check
  needs:
    # this is a rather expensive check, so we only run it if the others are OK
    - basics
    - pylint
  before_script:
    - pip install pyright==1.1.380
  script:
    # update 73 after fixing the current issues; for now we just try to make
    # sure we won't be adding new ones
    - PYTHONPATH=./resources pyright  --max-errors 73
  tags:
    - LINUX-DOCKER